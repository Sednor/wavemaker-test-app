<style id="Main.css">
</style>
<script id="Main.js">
Application.$controller("Kendo_data_tableController", ["$scope", function($scope) {
    "use strict";

    /*
     * This function will be invoked when any of this prefab's property is changed
     * @key: property name
     * @newVal: new value of the property
     * @oldVal: old value of the property
     */
    function propertyChangeHandler(key, newVal, oldVal) {

    }
    /* register the property change handler */
    $scope.propertyManager.add($scope.propertyManager.ACTIONS.CHANGE, propertyChangeHandler);

    $scope.onInitPrefab = function() {};

    $scope.onPageReady = function() {
        const COLUMNS = [];
        const FIELDS = {};
        const DATA_ID = $scope.Variables.dataId.getData().dataValue;
        const EDITABLE = $scope.Variables.editable.getData().dataValue;
        const REMOVABLE = $scope.Variables.removable.getData().dataValue;
        const CREATE = $scope.Variables.create.getData().dataValue;

        $scope.Variables.columns.getData().dataValue.forEach(column => {
            COLUMNS.push({
                field: column.name,
                title: column.title
            });
            FIELDS[column.name] = {
                type: column.type,
                editable: column.editable
            };
        });

        $(`#${$scope.Variables.kendoTableId.getData().dataValue}`).kendoGrid({
            dataSource: {
                transport: {
                    read: {
                        url: $scope.Variables.fetchUrl.getData().dataValue,
                    },
                    create: {
                        url: $scope.Variables.updateUrl.getData().dataValue,
                        type: "post",
                        dataType: 'json',
                        contentType: "application/json"
                    },
                    update: {
                        url: options => `${$scope.Variables.updateUrl.getData().dataValue}/${options[DATA_ID]}`,
                        type: "put",
                        dataType: 'json',
                        contentType: "application/json"
                    },
                    destroy: {
                        url: options => `${$scope.Variables.updateUrl.getData().dataValue}/${options[DATA_ID]}`,
                        type: "delete"
                    },
                    parameterMap: function(data, type) {
                        if (data.hasOwnProperty("pageSize")) {
                            const DATA = Object.assign({}, data, {
                                size: data.pageSize
                            });

                            DATA.pageSize = undefined;
                            return DATA;
                        }
                        if (type !== 'read') {
                            return JSON.stringify(data);
                        }
                    }
                },
                schema: {
                    data: "content",
                    model: {
                        id: DATA_ID,
                        fields: FIELDS
                    }
                },
                serverPaging: true,
                pageSize: 2,
                onRequestEnd: function(e) {
                    if (e.type == "destroy") {
                        if (!e.response.Errors) {
                            e.sender.read();
                        }
                    }
                }
            },
            columns: [].concat(COLUMNS, [{
                command: [].concat(EDITABLE ? ["edit"] : [], REMOVABLE ? ["destroy"] : [])
            }]),
            toolbar: CREATE ? ["create"] : [],
            pageable: {
                refresh: true,
                pageSizes: true,
                buttonCount: 5
            },
            editable: "popup"
        });
    }
}]);
</script>
<script id="Main.variables.json">
var _MainPage_Variables_ ={
  "columns" : {
    "_id" : "wm-columns-wm.Variable-1521022901422",
    "name" : "columns",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataBinding" : [ {
      "target" : "dataValue",
      "value" : "bind:columns",
      "type" : "string"
    } ],
    "dataSet" : {
      "dataValue" : ""
    },
    "type" : "string",
    "isList" : false,
    "saveInPhonegap" : false
  },
  "create" : {
    "_id" : "wm-create-wm.Variable-1521021821889",
    "name" : "create",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataBinding" : [ {
      "target" : "dataValue",
      "value" : "bind:create"
    } ],
    "dataSet" : {
      "dataValue" : true
    },
    "type" : "boolean",
    "isList" : false,
    "saveInPhonegap" : false
  },
  "dataId" : {
    "_id" : "wm-dataId-wm.Variable-1521018634134",
    "name" : "dataId",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataBinding" : [ {
      "target" : "dataValue",
      "value" : "bind:dataid",
      "type" : "string"
    } ],
    "dataSet" : {
      "dataValue" : "id"
    },
    "type" : "string",
    "isList" : false,
    "saveInPhonegap" : false
  },
  "editable" : {
    "_id" : "wm-editable-wm.Variable-1521021798281",
    "name" : "editable",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataBinding" : [ {
      "target" : "dataValue",
      "value" : "bind:editable"
    } ],
    "dataSet" : {
      "dataValue" : true
    },
    "type" : "boolean",
    "isList" : false,
    "saveInPhonegap" : false
  },
  "fetchUrl" : {
    "_id" : "wm-kendoTableSourceUrl-wm.Variable-1520942041831",
    "name" : "fetchUrl",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataBinding" : [ {
      "target" : "dataValue",
      "value" : "bind:fetch",
      "type" : "string"
    } ],
    "dataSet" : {
      "dataValue" : ""
    },
    "type" : "string",
    "isList" : false,
    "saveInPhonegap" : false
  },
  "kendoTableId" : {
    "_id" : "wm-kendoTableId-wm.Variable-1520940590561",
    "name" : "kendoTableId",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataBinding" : [ {
      "target" : "dataValue",
      "value" : "bind:kendotableid",
      "type" : "string"
    } ],
    "dataSet" : {
      "dataValue" : ""
    },
    "type" : "string",
    "isList" : false,
    "saveInPhonegap" : false
  },
  "removable" : {
    "_id" : "wm-removable-wm.Variable-1521021854982",
    "name" : "removable",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataBinding" : [ {
      "target" : "dataValue",
      "value" : "bind:removable"
    } ],
    "dataSet" : {
      "dataValue" : true
    },
    "type" : "boolean",
    "isList" : false,
    "saveInPhonegap" : false
  },
  "testEntry" : {
    "_id" : "wm-testEntry-wm.Variable-1520960279925",
    "name" : "testEntry",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataBinding" : [ ],
    "dataSet" : {
      "name" : "name0",
      "dataValue" : "dataValue0"
    },
    "type" : "entry",
    "isList" : false,
    "saveInPhonegap" : false
  },
  "updateUrl" : {
    "_id" : "wm-updateUrl-wm.Variable-1520952158186",
    "name" : "updateUrl",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataBinding" : [ {
      "target" : "dataValue",
      "value" : "bind:update",
      "type" : "string"
    } ],
    "dataSet" : {
      "dataValue" : ""
    },
    "type" : "string",
    "isList" : false,
    "saveInPhonegap" : false
  }
}
</script>
<script id="Main.html" type="text/ng-template">
<wm-page data-ng-controller="Kendo_data_tableController" name="page1">
    <wm-content name="content1">
        <table ng-attr-id="{{ Variables.kendoTableId.getData().dataValue }}"></table>
    </wm-content>
</wm-page>
</script>